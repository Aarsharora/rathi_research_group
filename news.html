<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News || Rathi Lab </title>
    <link rel="Icon" type="image/x-icon" href="assets/img/favicon.ico">
    <link rel="stylesheet" href="assets/css/news.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <!-- Navigation -->
    <div class="navigation">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="index.html"><img
                        src="assets/img/Screenshot_2025-11-12_131002-removebg-preview.png" class="img-fluid"
                        style="width: 90px;" alt="">R.R.G</a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="research.html">Research</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="news.html">News</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="collabration.html">Collaboration</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="publication.html">Publication</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="team.html">Team</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="gallry.html">Gallery</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <div class="breadcrumb-section">
        <div class="breadcrumb-container">
            <nav class="breadcrumb-nav" aria-label="Breadcrumb">
                <a href="index.html" class="breadcrumb-item">
                    <svg class="home-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                    </svg>
                    Home
                </a>

                <span class="breadcrumb-separator">‚Ä∫</span>

                <a href="news.html" class="breadcrumb-item">
                    News
                </a>
            </nav>

            <h1 class="page-title text-center">News & Updates</h1>
            <p class="page-description text-center">Stay updated with the latest news, announcements, and achievements related to our work. This page features important updates, event highlights, project milestones, and insights into our ongoing research and activities.</p>
        </div>
    </div>
    <div class="news-container">

        <div class="news-layout">
            <!-- Headlines Sidebar -->
            <div class="headlines-sidebar">
                <h2>Headlines</h2>
                <div class="headlines-scroll" id="headlinesScroll">
                    <!-- Headlines will be duplicated for continuous scroll -->
                </div>
            </div>

            <!-- News Content -->
            <div class="news-content" id="newsContainer">
                <!-- News articles will load here dynamically -->
            </div>

            <div class="load-more">
                <button class="load-more-btn" id="loadMoreBtn">Load More News</button>
            </div>

        </div>
    </div>
    <div class="scroll-top" id="scrollTopBtn">
        <i class="fas fa-chevron-up"></i>
    </div>

    <footer class="footer-section">
        <div class="footer-content">
            <!-- Logo -->
            <div class="logo-container">
                <img class="logo-icon" src="assets/img/second logo 1.png">

                </img>
                <div class="logo-text">Rathi Lab</div>
            </div>

            <!-- Navigation Menu -->
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="research.html">Research</a></li>
                <li><a href="publication.html">Publications</a></li>
                <li><a href="team.html">Team</a></li>
                <li><a href="gallry.html">Gallery</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>

            <!-- Email Icon -->
            <div class="email-icon">
                <a href="mailto:rathi@mit.edu" title="Email Us">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>

            <!-- Bottom Section -->
            <div class="footer-bottom">
                <!-- MIT Logo -->
                <!-- Copyright -->
                <div class="copyright">
                    ¬© 2025 <strong>Rathi Research Group</strong>. All rights reserved.
                    Proudly created by <strong><a href="https://arsharora.netlify.app/"
                            style="text-decoration: none; color: inherit;">Arsh Arora</strong></a>.
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="assets/js/Main.js"></script>
<!-- 
    <script>
        async function loadHeadlines() {
            try {
                const response = await fetch('http://localhost:5000/api/news');
                const data = await response.json();

                // Handle if data is wrapped in { success: true, data: [...] }
                const headlines = Array.isArray(data) ? data : data.data || [];

                const headlinesScroll = document.getElementById('headlinesScroll');

                if (!headlines.length) {
                    headlinesScroll.innerHTML = `<div class="headline-item">No news available at the moment.</div>`;
                    return;
                }

                // Render titles only
                const headlinesHTML = headlines
                    .map(h => `
          <div class="headline-item">
            <div class="headline-title">üì∞ ${h.title}</div>
          </div>
        `)
                    .join('');

                // Duplicate for seamless scroll
                headlinesScroll.innerHTML = headlinesHTML + headlinesHTML;
            } catch (error) {
                console.error('Error fetching headlines:', error);
                document.getElementById('headlinesScroll').innerHTML = `<div class="headline-item">Failed to load headlines.</div>`;
            }
        }

        // Load on page start
        loadHeadlines();
    </script> -->

    <script>
        // ============================================
        // Sticky Navigation on Scroll
        // ============================================
        window.addEventListener('scroll', function () {
            const navigation = document.querySelector('.navigation');

            if (window.scrollY > 200) {
                navigation.classList.add('sticky');
                document.body.style.paddingTop = navigation.offsetHeight + 'px';
            } else {
                navigation.classList.remove('sticky');
                document.body.style.paddingTop = '0';
            }
        });

        // ============================================
        // Active Page Highlight
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = document.querySelectorAll('.nav-link');

            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });
        });

        // ============================================
        // Close Mobile Menu on Link Click
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const navbarCollapse = document.querySelector('.navbar-collapse');

            navLinks.forEach(link => {
                link.addEventListener('click', function () {
                    if (navbarCollapse.classList.contains('show')) {
                        const bsCollapse = new bootstrap.Collapse(navbarCollapse, {
                            toggle: false
                        });
                        bsCollapse.hide();
                    }
                });
            });
        });

    </script>
    <script>
        let allNews = [];
        let visibleCount = 3; // pehle 3 articles show honge

        async function loadNews() {
            const newsContainer = document.getElementById("newsContainer");
            
            // Show loading message
            if (newsContainer) {
                newsContainer.innerHTML = '<div style="text-align: center; padding: 40px;"><p>Loading news...</p></div>';
            }
            
            try {
                // Try /news endpoint first, then fallback to /api/news
                let res = await fetch("http://localhost:3000/news");
                let endpointUsed = "http://localhost:3000/news";
                
                console.log("Trying endpoint:", endpointUsed);
                console.log("Response status:", res.status);
                console.log("Response ok:", res.ok);
                
                // If 404, try /api/news as fallback
                if (!res.ok && res.status === 404) {
                    console.log("404 on /news, trying /api/news...");
                    endpointUsed = "http://localhost:3000/api/news";
                    res = await fetch(endpointUsed);
                    console.log("Fallback endpoint:", endpointUsed);
                    console.log("Response status:", res.status);
                    console.log("Response ok:", res.ok);
                }
                
                if (!res.ok) {
                    throw new Error(`Server returned ${res.status}: ${res.statusText} from ${endpointUsed}`);
                }
                
                console.log("‚úÖ Successfully connected to:", endpointUsed);
                
                const data = await res.json();
                console.log("=== API RESPONSE ===");
                console.log("Full data:", data);
                console.log("Data type:", typeof data);
                console.log("Is array?", Array.isArray(data));
                if (data && typeof data === 'object') {
                    console.log("Object keys:", Object.keys(data));
                }
                console.log("===================");
                
                // Extract array from response
                let newsArray = [];
                
                if (Array.isArray(data)) {
                    // Direct array
                    newsArray = data;
                    console.log("‚úÖ Using direct array, length:", newsArray.length);
                } else if (data && typeof data === 'object') {
                    // Check common property names
                    if (Array.isArray(data.data)) {
                        newsArray = data.data;
                        console.log("‚úÖ Found array in data.data, length:", newsArray.length);
                    } else if (Array.isArray(data.news)) {
                        newsArray = data.news;
                        console.log("‚úÖ Found array in data.news, length:", newsArray.length);
                    } else if (Array.isArray(data.items)) {
                        newsArray = data.items;
                        console.log("‚úÖ Found array in data.items, length:", newsArray.length);
                    } else if (Array.isArray(data.result)) {
                        newsArray = data.result;
                        console.log("‚úÖ Found array in data.result, length:", newsArray.length);
                    } else {
                        console.error("‚ùå No array found in response!");
                        console.error("Available keys:", Object.keys(data));
                        newsArray = [];
                    }
                } else {
                    console.error("‚ùå Unexpected data type:", typeof data);
                    newsArray = [];
                }
                
                // Process the news array
                if (Array.isArray(newsArray) && newsArray.length > 0) {
                    console.log("‚úÖ Processing", newsArray.length, "news items");
                    
                    // Sort by date (latest first) - only if array exists
                    allNews = newsArray.sort((a, b) => {
                        const dateA = new Date(a.date || 0);
                        const dateB = new Date(b.date || 0);
                        return dateB - dateA;
                    });
                    
                    console.log("‚úÖ Sorted news:", allNews);
                    renderNews();
                } else {
                    console.warn("‚ö†Ô∏è No news items found");
                    allNews = [];
                    if (newsContainer) {
                        newsContainer.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #666;">
                                <p style="font-size: 18px; margin-bottom: 10px;">No news available at the moment.</p>
                                <p style="font-size: 14px; color: #999;">Please add some news items to the database.</p>
                            </div>
                        `;
                    }
                    const loadMoreBtn = document.getElementById("loadMoreBtn");
                    if (loadMoreBtn) loadMoreBtn.style.display = "none";
                }
            } catch (err) {
                console.error("‚ùå ERROR fetching news:", err);
                console.error("Error details:", {
                    message: err.message,
                    stack: err.stack
                });
                
                if (newsContainer) {
                    newsContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #d32f2f;">
                            <p style="font-size: 18px; margin-bottom: 10px; font-weight: bold;">‚ùå Failed to load news</p>
                            <p style="font-size: 14px; color: #666; margin-bottom: 5px;">Error: ${err.message}</p>
                            <p style="font-size: 12px; color: #999; margin-top: 10px;">
                                Please check:<br>
                                1. Server is running on localhost:3000<br>
                                2. API endpoint is /news (not /api/news)<br>
                                3. CORS is enabled on server<br>
                                4. Check browser console for more details
                            </p>
                        </div>
                    `;
                }
                const loadMoreBtn = document.getElementById("loadMoreBtn");
                if (loadMoreBtn) loadMoreBtn.style.display = "none";
            }
        }

        function renderNews() {
            const newsContainer = document.getElementById("newsContainer");
            
            if (!newsContainer) {
                console.error("‚ùå newsContainer element not found!");
                return;
            }
            
            if (!allNews || allNews.length === 0) {
                console.warn("‚ö†Ô∏è allNews is empty");
                newsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <p style="font-size: 18px;">No news to display.</p>
                    </div>
                `;
                const loadMoreBtn = document.getElementById("loadMoreBtn");
                if (loadMoreBtn) loadMoreBtn.style.display = "none";
                return;
            }
            
            console.log("üé® Rendering", allNews.length, "news items");
            newsContainer.innerHTML = ""; // clear previous content

            const visibleNews = allNews.slice(0, visibleCount);
            console.log("üìÑ Showing", visibleNews.length, "of", allNews.length, "items");

            visibleNews.forEach((item, index) => {
                console.log(`Rendering item ${index + 1}:`, item);
                
                // Safe date formatting
                let formattedDate = "Date not available";
                try {
                    if (item.date) {
                        const dateObj = new Date(item.date);
                        if (!isNaN(dateObj.getTime())) {
                            formattedDate = dateObj.toLocaleDateString("en-US", {
                                year: "numeric",
                                month: "long",
                                day: "numeric"
                            });
                        }
                    }
                } catch (e) {
                    console.error("Date parsing error for item:", item, e);
                }

                const article = `
        <article class="news-article">
          <img src="${item.imageUrl || 'https://via.placeholder.com/400x250?text=No+Image'}" 
               alt="${item.title || 'News image'}" 
               class="news-image" 
               onerror="this.src='https://via.placeholder.com/400x250?text=No+Image'">
          <div class="news-body">
            <div class="news-meta">
              <span class="news-date">üìÖ ${formattedDate}</span>
            </div>
            <h3>${item.title || 'Untitled'}</h3>
            <p>${item.content || 'No content available'}</p>
            <a href="#" class="read-more">Read More ‚Üí</a>
          </div>
        </article>
      `;
                newsContainer.insertAdjacentHTML("beforeend", article);
            });

            // Hide/show load more button
            const loadMoreBtn = document.getElementById("loadMoreBtn");
            if (loadMoreBtn) {
                if (visibleCount >= allNews.length) {
                    loadMoreBtn.style.display = "none";
                    console.log("‚úÖ All news items displayed, hiding load more button");
                } else {
                    loadMoreBtn.style.display = "block";
                    console.log("üìÑ More items available, showing load more button");
                }
            }
        }

        // Wait for DOM to be ready
        document.addEventListener("DOMContentLoaded", function() {
            console.log("üöÄ DOM loaded, starting to fetch news...");
            
            // Load news on page load
            loadNews();
            
            // Set up load more button listener
            const loadMoreBtn = document.getElementById("loadMoreBtn");
            if (loadMoreBtn) {
                loadMoreBtn.addEventListener("click", () => {
                    console.log("üîÑ Load more clicked");
                    visibleCount += 3;
                    renderNews();
                });
            } else {
                console.warn("‚ö†Ô∏è loadMoreBtn element not found!");
            }
        });
    </script>
</body>

</html>